---
title: "Getting Started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The OMOP Vocabularies must be fetched and transformed into a `nodes.and.edges` Class object before 
using any of chariotViz's features.  

```{r setup}
library(chariotViz)
library(tidyverse)
```

A version key is derived from the log created by default when loading the OMOP Vocabularies 
using the setupAthena package. This list is the hash to cache the subsequent SQL query resultsets 
under.  

```{r,results='hide'}
# Fetch from Postgres  
version_key <- 
  get_version_key()
version_key
```

```{r}
omop_relationships <-
  fetch_omop(version_key = version_key)
```

The list used as the hash is fully customizable by the user. The object can also be set to NULL if a hash is not desired. 

```{r,eval=FALSE}
omop_relationships <- 
  fetch_omop(version_key = list(A = 1, 
                                B = 2))

omop_relationships <- 
  fetch_omop(version_key = NULL)
```

```{r}
nodes_and_edges <-
omop_relationships %>%
  create_nodes_and_edges()
nodes_and_edges
```

```{r}
nodes_and_edges <- 
  nodes_and_edges %>%
  map_node_attributes() %>%
  map_edge_attributes()
nodes_and_edges
```

```{r}
nodes_and_edges <- 
  nodes_and_edges %>% 
  add_tooltip()
nodes_and_edges
```

```{r}
graph <- 
  construct_graph(nodes_and_edges)
```

```{r}
library(DiagrammeR)
subgraph <- 
  graph$graph %>% 
    select_nodes(vocabulary_id == "HemOnc") %>%
    trav_out_edge() %>%
    transform_to_subgraph_ws() 

create_legend(subgraph)

render_graph(subgraph)
```

